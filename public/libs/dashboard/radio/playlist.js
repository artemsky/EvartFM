$(function(){"use strict";var t=!1,a=[],e=[],n=function(){return $(".sortable.playlist").sortable({receive:function(t,a){var n=a.item.clone(),i=Date.now();n.find(".name").attr("data-track-id",i),$(this).append(n);var r=n.parent().parent(),s=n.find(".name"),o=r.attr("id"),l=-1;e.forEach(function(t,a){t.name==o&&(l=a)}),l>=0?e[l].tracklist.push({id:i,name:s.text()}):e.push({id:r.attr("data-playlist-id"),name:r.attr("id"),tracklist:[{id:i,name:s.text()}]})},over:function(){t=!1},out:function(){t=!0},beforeStop:function(e,n){if(1==t){n.item.remove();var i=n.item.find(".name").attr("data-track-id");a.push(parseInt(i))}}})},i={type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},error:function(t){var a=window.open("",":Error Message","menubar=no, location=no");a.document.write(t.responseText)}},r=n();$(".sortable.files").sortable({connectWith:".sortable.playlist",remove:function(t,a){$(this).sortable("cancel")}}),$(".tab-content").on("click",".delete-current",function(){var t=$(this).parent().attr("id");return!!confirm("Are you shure you want to delete "+t+"?")&&(i.type="delete",i.data={id:$(this).parent().attr("data-playlist-id")},i.success=function(a){$.notify("Playlist: "+t+" - "+a.message,"success")},$.ajax($(this).attr("data-url"),i),$(this).parent().remove(),void $("#"+t+"-tab").parent().remove())}),$(".new-list").on("click",function(){var t=$.trim(prompt("Enter playlist name"));if(!t)return!1;$(".tab-content").append('<div role="tabpanel" class="tab-pane" id="'+t+'" data-playlist-id="'+Date.now()+'"><div class="sortable playlist"></div><button type="button" class="btn btn-warning w100 delete-current">Delete this list</button></div>'),$("ul.dropdown-menu").append('<li><a href="#'+t+'" role="tab" id="'+t+'-tab" data-toggle="tab" aria-controls="'+t+'" aria-expanded="true">'+t+"</a></li>");var a=($("#"+t),$("#"+t+"-tab"));$("ul.dropdown-menu li").removeClass("active"),a.trigger("click"),$("ul.dropdown-menu li #"+t+"-tab").parent().addClass("active"),r.sortable("destroy"),r=n()}),$(".save-changes").on("click",function(){e.forEach(function(t){t.tracklist=t.tracklist.filter(function(t){return a.indexOf(t.id)<0})}),i.data={forSave:e,forDelete:a},i.success=function(t){t.ids&&(t.ids.trackIds.forEach(function(t){$("[data-track-id='"+t.old+"']").attr("data-track-id",t["new"])}),t.ids.playlistIds.forEach(function(t){$("[data-playlist-id='"+t.old+"']").attr("data-playlist-id",t["new"])})),$.notify(t.message,"success"),e=[],a=[]},$.ajax($(this).attr("data-url"),i)}),$(function(){var t=null,a=function(t){var a=$(t).parent().find("audio").get(0);a.paused?(a.play(),$(t).addClass("glyphicon-pause").removeClass("glyphicon-play")):(a.pause(),$(t).addClass("glyphicon-play").removeClass("glyphicon-pause"))};$(".sortable").on("click",".play",function(){null==t&&(t=$(this)),t.is($(this))?a(this):(a(t),a(this),t=$(this))})})});