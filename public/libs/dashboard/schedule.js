!function(){"use strict";switch(_.templateSettings={evaluate:/\{\{%([\s\S]+?)%\}\}/g,interpolate:/\{\{%=([\s\S]+?)%\}\}/g,escape:/\{\{%-([\s\S]+?)%\}\}/g},$('meta[name="lang"]').attr("content")){case"ru":moment.locale("ru");break;default:moment.locale("en-gb")}var e={disk:sessionStorage||localStorage,target:{name:null,object:null,rendered:null,repeat:null},get:function(e){return this.target.repeat=!1,this.disk.getItem(e)?(this.target.object=JSON.parse(this.disk.getItem(e)),this.target.name=e,this):null},set:function(e,t){return this.target.repeat=!1,this.disk.setItem(e,JSON.stringify(t)),this.target.name=e,this},add:function(e){var t=e.id>0?e.id:Date.now(),a={id:t,title:e.title,description:e.description,date:e.date,playlist:e.playlist,repeat:{event_id:t,everyDay:e.everyDay?1:0,everyWeek:e.everyWeek?1:0}};if(e.days)for(var n=Object.keys(e.days),i=n.length;i--;){var r=n[i];a.repeat[r]=e.days[r]}var s=!1;return this.target.object.forEach(function(e,t,n){e.id==a.id&&(s=!0,n[t]=a)}),s||this.target.object.push(a),this},del:function(e){for(var t in this.target.object)this.target.object[t].id==e&&delete this.target.object[t];return this},save:function(e){this.set("events",this.target.object),this.ajaxUpdate(e)},whereDate:function(e){if(!e)return null;for(var t in this.target.object)if(this.target.object[t].date.substring(0,10)==e)return this.target.object=[this.target.object[t]],this;return this.target.object=[],this},whereId:function(e){if(!e)return null;for(var t in this.target.object)if(this.target.object[t].id==e)return this.target.object=[this.target.object[t]],this;return this.target.object=[],this},repeat:function(){return this.target.repeat=!0,this},getRendered:function(e){var t="YYYY-MM-DD HH:mm";return this.target.renderd=[],e/=2,this.target.object.forEach(function(a){var n={everyDay:!1,everyWeek:!1};if(a.repeat.everyDay){n.everyDay=!0;for(var i=moment(a.date),r=-e;r<e;r++)a.date=moment(i).add(r,"days").format(t),this.target.renderd.push($.extend(!0,{},a))}else if(a.repeat.everyWeek){n.everyWeek=!0;for(var s=Math.floor(e/7),o=moment().week(),r=-s;r<s;r++){var c=moment(a.date).week(o+r);for(var d in a.repeat)switch(d){case"mon":case"tue":case"wed":case"thu":case"fri":case"sat":case"sun":a.repeat[d]&&(a.date=c.day(d).format(t),this.target.renderd.push($.extend(!0,{},a)))}}}n.everyDay||n.everyWeek||this.target.renderd.push($.extend(!0,{},a))}.bind(this)),this.target.renderd},result:function(){if(!this.target.repeat)return this.target.object;var e=[];for(var t in this.target.object){for(var a=Object.keys(this.target.object[t].repeat),n={},i={},r="",s=a.length;s--;)switch(r=a[s]){case"mon":case"tue":case"wed":case"thu":case"fri":case"sat":case"sun":n[r]=this.target.object[t].repeat[r];break;default:i[r]=this.target.object[t].repeat[r]}i.days=n,e.push(i)}return e},ajaxUpdate:function(e){var t={type:"POST",cache:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){$.notify("Successfully saved","success"),e(t)},error:function(e){var t=window.open("",":Error Message","menubar=no, location=no");t.document.write(e.responseText)},data:{events:this.get("events").target.object}};$.ajax("schedule/events/update",t)}},t=function(t){$("#fountainTextG").hide(),e.set("events",t.events),e.set("playlists",t.playlists);var a=e.get("events").getRendered(60),n=e.get("playlists").result();l(a),d(n)},a=function(e){$("#fountainTextG").hide(),console.log(e)},n={type:"GET",cache:!1,success:t,error:a};$.ajax("schedule/events",n);var i={},r=$("#day-events").html(),s=$("#modal"),o=function(t,a){var n=$("#datetimepicker"),i={checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue",increaseArea:"20%"};$("#repeat-day").iCheck("uncheck").iCheck(i).on("ifUnchecked",function(){n.datetimepicker("destroy").datetimepicker(),$("#repeat-month").iCheck("enable"),r.iCheck("enable")}).on("ifChecked",function(){n.datetimepicker("destroy").datetimepicker({datepicker:!1,format:"H:i"}),$("#repeat-month").iCheck("disable"),r.iCheck("disable")}),n.datetimepicker("destroy").datetimepicker(t);var r=$("#repeat-on");r.hide(),$("#repeat-month").iCheck("uncheck").iCheck(i).on("ifUnchecked",function(){r.hide()}).on("ifChecked",function(){$("[id*='repeat-on-']").iCheck(i),r.show()}),a&&!function(){var t=e.get("events").whereId(a).repeat().result()[0];if(t.everyWeek){$("#repeat-month").iCheck("check");for(var n in t.days)$("#repeat-on-"+n).iCheck(t.days[n]?"check":"uncheck")}t.everyDay&&$("#repeat-day").iCheck("check")}(),s.modal("show")},c=function(t){var a=$.trim($("#Title").val()),n=$.trim($("#Description").val()),r=$("#repeat-day").prop("checked"),o=$("#datetimepicker").val();if(!a)return $("#Title").tooltip({trigger:"manual"}).tooltip("show"),void setTimeout(function(){$("#Title").tooltip("destroy")},2e3);if(!r){var c=$("#repeat-month").prop("checked");if(c){var d={};$("[id*='repeat-on-']").each(function(e,t){d[$(t).attr("id").substring(10)]=$(t).prop("checked")?1:0})}}e.get("events").add({id:t||-1,title:a,date:r?moment(o,"HH:mm").format("YYYY-MM-DD HH:mm"):o,playlist:$("#playlist option:selected").val(),description:n,everyDay:r,everyWeek:c,days:d}).save(function(t){e.set("events",function(){return e.get("events").result().map(function(e){return t.forEach(function(t){e.id=e.id==t.old?t["new"]:e.id}),e})}()),console.log(e.get("events").result()),i.setEvents(e.get("events").getRendered(60)),s.modal("hide")})},d=function(e){var t=$("#playlist");e.forEach(function(e){t.append("<option value='"+e.id+"'>"+e.name+"</option>")}),t.selectpicker("refresh")},l=function(t){i=$("#full-clndr").clndr({template:$("#full-clndr-template").html(),events:t,clickEvents:{click:function(e){var t=_.template(r);$(".day-events").mCustomScrollbar("destroy").html(t({eventsThisDay:e.events})).height($(".clndr-grid .days").height()-$(".clndr-grid .days-of-the-week").height()).mCustomScrollbar({scrollButtons:{enable:!0},theme:"minimal-dark"}),$(".event-item-hover").each(function(e,t){$(t).css("transform","translateX("+$(t).width()+"px)")})}},forceSixRows:!0,multiDayEvents:{singleDay:"date",endDate:"endDate",startDate:"startDate"},showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,trackSelectedDate:!0,daysOfTheWeek:function(){for(var e=[],t=0;t<7;t++)e.push(moment().weekday(t).format("ddd"));return e}(),doneRendering:function(){$(".event-items").height($(".clndr-grid .days").height()-$(".clndr-grid .days-of-the-week").height()).mCustomScrollbar({scrollButtons:{enable:!0},theme:"minimal-dark"});var t=$("#full-clndr");t.find(".today").length>0?t.find(".today").click():t.find(".day").eq(0).click();var a=$(".event-listing-title");a.on("click",".glyphicon-chevron-up, .glyphicon-chevron-down",function(){var e={},t={open:"glyphicon-chevron-up",close:"glyphicon-chevron-down"},a=$(this);e=a.parent().hasClass("month-title")?$(".day-title [class *=glyphicon-chevron]").eq(0):$(".month-title [class *=glyphicon-chevron]").eq(0),e.hasClass(t.open)?e.removeClass(t.open).addClass(t.close):e.removeClass(t.close).addClass(t.open),a.hasClass(t.open)?a.removeClass(t.open).addClass(t.close):a.removeClass(t.close).addClass(t.open),$(".event-items, .day-events").slideToggle(),$(".event-item-hover").each(function(e,t){$(t).css("transform","translateX("+$(t).width()+"px)")})});var n={step:30},r=!1;$(".event-listing").on("click",".event-item",function(e){e.stopPropagation();var t=$(this).find(".event-item-hover");r?t.css("transform","translateX("+t.width()+"px)"):t.css("transform","translateX(0px)"),r=!r}).on("click",".event-item span:first-child",function(t){t.stopPropagation();var a=$(this).parent().parent();s.find("form").get(0).reset(),s.find(".modal-title").text("Edit event"),n.value=a.find(".event-item-time").attr("data-datetime"),s.find("#Title").val(a.find(".event-item-name").text()),s.find("#Description").val(a.find(".event-item-location").text()),o(n,a.attr("data-id")),s.find(".save-changes").off("click").on("click",c.bind(null,a.attr("data-id"))),s.find(".delete-event").off("click").on("click",function(){$.get("schedule/events/delete/"+a.attr("data-id")).done(function(){i.setEvents(e.get("events").del(parseInt(a.attr("data-id"))).getRendered(60)),s.modal("hide")})}),s.find(".delete-event").show(),$("#playlist").selectpicker("val",a.attr("data-playlist")||0)}),$(".event-listing").on("click",".event-item .event-item-hover span:last-child",function(e){e.stopPropagation(),$(this).toggleClass("text-info");var t=$(this).parent().parent(),a=t.attr("data-id"),n=$('.days [data-id*="'+a+'"]');if(!$(this).hasClass("text-info"))return void n.css("background-color","#eee");var i=function(){for(var e="BCDEF".split(""),t="#",a=0;a<6;a++)t+=e[Math.floor(Math.random()*e.length)];return t}();n.css("background-color",i)}),a.on("click",".glyphicon-plus",function(){s.find("form").get(0).reset(),s.find(".modal-title").text("Add event"),$(this).parent().hasClass("day-title")&&(n.value=function(){var e=" "+moment().format("HH:mm"),t=$(i.element).find(".selected");return t.length>0?t.attr("data-date")+e:$(i.element).find("today").attr("data-date")+e}()),o(n),s.find(".delete-event").hide(),s.find(".save-changes").off("click").on("click",c.bind(null,$(this).attr("data-date")))}),t.height(t.height())}})}}();